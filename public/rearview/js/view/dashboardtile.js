define(["view/base"],function(e){var t=e.extend({events:{"click .save.btn":"save","click .settings.btn":"settings","click figure.front":"loadDashboard","click .cancel.btn":"settings","click .add.btn":"addCategory"},initialize:function(e){_.bindAll(this),this.templar=e.templar,this.intervalLength=e.intervalLength?e.intervalLength:60,this.render()},render:function(){this.templar.render({path:"dashboardtile",el:this.$el,append:!0,data:{dashboard:this.model.toJSON()}}),this.$dashboardTile=this.$el.find(".dashboard"+this.model.get("id")),this.setElement(this.$dashboardTile),this.startStatusCheck()},loadDashboard:function(){location.href="#dash/"+this.model.get("id")},addCategory:function(){Backbone.Mediator.pub("view:dashboard:add",{dashboard:{id:this.model.get("id"),name:this.model.get("name"),children:this.model.get("children")}})},startStatusCheck:function(){this.updateTile(),this.interval=setInterval(function(){this.updateTile()}.bind(this),1e3*this.intervalLength),clearInterval(this.interval)},updateTile:function(){$.ajax({url:"/dashboards/"+this.model.get("id")+"/jobs.json",success:function(e){_.map(e,function(e){e.createdAt=e.createdAt?this.formatServerDateTime(e.createdAt,!0):e.createdAt,e.modifiedAt=e.modifiedAt?this.formatServerDateTime(e.modifiedAt,!0):e.modifiedAt},this),this.checkErrorState(e)}.bind(this)})},checkErrorState:function(e){for(var t=!1,i=e.length-1;i>=0;i--)if("success"!=e[i].status&&"undefined"!=typeof e[i].status&&e[i].active){t=!0;break}t?this.$el.find(".dashboard"+this.model.get("id")).addClass("red"):this.$el.find(".dashboard"+this.model.get("id")).removeClass("red")},settings:function(e){e.stopPropagation(),this.$dashboardTile.toggleClass("flipped"),setTimeout(function(){this.$dashboardTile.find(".front .btn").toggle()}.bind(this),600)},save:function(e){e.stopPropagation(),this.model.save({name:this.$dashboardTile.find(".dashboard-name").val()},{success:function(){Backbone.Mediator.pub("view:dashboard:save",{model:this.model,message:"Your changes to '"+this.model.get("name")+"' dashboard were saved.",attention:"Dashboard Saved!"})}.bind(this),error:function(e){Backbone.Mediator.pub("view:dashboard:save",{model:this.model,message:"The dashboard '"+e.get("name")+"' produced an error during the process of saving.",attention:"Dashboard Save Error!",status:"error"})}.bind(this)})},destructor:function(){clearInterval(this.interval),this.remove(),this.$el.remove(),this.off(),this.model.off()}});return t});