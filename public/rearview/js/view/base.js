define(["jquery","underscore","backbone","handlebars","highcharts","underscore-string","highcharts-theme","xdate","backbone-mediator"],function(e,t,i,n){var r=i.View.extend({assetRoot:"public/",intervalDiviser:4,infiniteTimes:[],infiniteLabels:[],infiniteTimesInt:[],addHelpers:function(){n.registerHelper("nl2br",function(e){var t=(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2");return new n.SafeString(t)})},destroySubscriptions:function(){for(sub in this.subscriptions)i.Mediator.unsubscribe(sub,this[this.subscriptions[sub]],this)},drawAsInfinite:function(e){var i=e.match(/^drawAsInfinite\((.*)\)$/);return i?t.last(i):null},formatGraphData:function(e){var i=t.reduce(t.keys(e),function(i,n){var r=e[n];return e[n]={},e[n].graphite=r,e[n].xInt=[],e[n].x=[],e[n].y=[],t.each(e[n].graphite,function(t){e[n].x.push(new XDate(1e3*t[0]).toUTCString("HH:mm")),e[n].y.push(t[1]),e[n].xInt.push(t[0])}),e},[]);return i},focusFirst:function(){this.$el.find("input[type=text]:first").focus()},initGraph:function(e){var t=this;return t.chart=new Highcharts.Chart({exporting:{buttons:{exportButton:{enabled:!1},printButton:{enabled:!1}}},credits:{enabled:!1},chart:{zoomType:"x",spacingRight:24,animation:!0,renderTo:e,type:"line",borderRadius:3,backgroundColor:{stops:[[0,"rgb(16, 16, 16)"],[1,"rgb(16, 16, 16)"]]}},title:{text:null},xAxis:{minTickInterval:this,title:{text:null}},yAxis:{title:{text:null}},plotOptions:{column:{animation:!0},series:{animation:!1,marker:{enabled:!1}}},tooltip:{animation:!0}}),t.chart},keyOrder:function(e){var i=[];return i=t.keys(e),i=t.sortBy(i,function(e){return e.toLowerCase()})},renderGraphData:function(e,i){for(var n=this,r=[],s=["#4572A7","#AA4643","#89A54E","#80699B","#3D96AE","#DB843D","#92A8CD","#A47D7C","#B5CA92"];e.series.length>0;)e.series[0].remove(!0);e.xAxis[0].removePlotLine("plotLine"),n.infiniteTimes=[],n.infiniteTimesInt=[],n.infiniteLabels=[],t.each(i,function(e,t){if(n.drawAsInfinite(t)){for(var r=[],s=[],a=0;a<e.xInt.length;a++)e.y[a]&&(r.push(e.x[a]),s.push(e.xInt[a]));n.infiniteTimes.push(r),n.infiniteTimesInt.push(s),n.infiniteLabels.push(n.drawAsInfinite(t)),delete i[t]}});for(var a=n.keyOrder(i),o=0;o<a.length;o++){var l=i[a[o]];e.xAxis[0].setCategories(l.x),e.xAxis[0].options.tickInterval=parseInt(l.x.length/n.intervalDiviser,10),e.xAxis[0].setExtremes(null,null),e.addSeries({name:a[o],data:l.y,animation:!1,color:s[o]}),r=t.union(r,l.xInt)}if(n.infiniteTimes.length)for(var h=n.infiniteTimes.length-1,o=h;o>=0;o--){var u=n.infiniteTimesInt[o];if(u.length)for(var d=0;d<u.length;d++){var c=t.sortedIndex(r,u[d]);t.isNull(c)||e.xAxis[0].addPlotLine({id:"plotLine",value:c,color:"green",dashStyle:"shortdash",width:2,label:{text:n.infiniteLabels[o],style:{color:"#ccc"}}})}}},formatServerDateTime:function(e,t){var i=e.toString().length;return 10==i?new XDate(1e3*parseInt(e,10),t):new XDate(parseInt(e,10),t)},parseAlertKeys:function(e){var i=[],n=e.split("\n");return t.each(n,function(e){i.push(t.str.words(e,/([ \,])/))}),i=t.flatten(i),i=t.filter(i,function(e){return!t.str.isBlank(e)&&","!==e})},resizeModal:function(t,i,n){var r=e(window).width(),s=e(window).height(),a=.8;switch(i){case"small":widthMultipler=.3;break;case"medium":widthMultipler=.6;break;case"large":widthMultipler=.9;break;default:widthMultipler=.6}return t.css({width:r*widthMultipler,marginLeft:-(r*(widthMultipler/2))}),n||(t.css({height:s*a}),t.find(".modal-body").css({maxHeight:s*a-140,height:s*a-149})),t.each(function(){e(this).css({marginTop:-(e(this).height()/2)})}),t.addClass("modal-"+i),{height:t.height(),width:t.width(),body:{height:t.find(".modal-body").height(),width:t.find(".modal-body").width()}}},_processRadioControl:function(i,n){var r=t.map(i,function(t){return e(t).attr("data-value")});return r.length>0?r.join(","):n?n:""},_createCronExpr:function(){var e=this;return[0,e.$el.find("#inputMinutes").val(),e.$el.find("#inputHours").val(),e.$el.find("#inputDays").val(),e._processRadioControl(e.$el.find(".month-picker button.active"),"*"),e._processRadioControl(e.$el.find(".day-picker button.active"),"?")].join(" ")},showOverlay:function(t,i,n){var r=this;if(t=e(t),!r.overlay){var n=n?n:"";r.overlay=e("<div class='overlay "+n+"'><h1></h1></div>"),t.append(r.overlay)}r.overlay.find("h1").html(i),r.overlay.show()},hideOverlay:function(){var e=this;e.overlay.hide()},_toggleFullscreen:function(t,i,n,r){var s=e(t);s.hasClass("fullscreen")?(n&&r&&(n.show(),r.hide()),s.removeClass("fullscreen"),s.height(s.data("beforeFullscreen").height),s.width(s.data("beforeFullscreen").width),i.refresh()):(n&&r&&(n.hide(),r.show()),s.data("beforeFullscreen",{height:s.height(),width:s.width()}),s.addClass("fullscreen"),s.width("100%"),s.height("100%"),i.setSize("100%","100%"),i.refresh())},_validateMirror:function(t){var i=this,n=e(t.getWrapperElement());return i._isNonblank(t.getValue())?(n.removeClass("error"),!0):(n.addClass("error"),!1)},_isNonblank:function(e){var t=/\S/;return-1!=String(e).search(t)},getPositions:function(t){var i=e(t).offset(),n=e(t).width(),r=e(t).height();return[[i.left,i.left+n],[i.top,i.top+r]]},comparePositions:function(e,t){var i=e[0]<t[0]?e:t,n=e[0]<t[0]?t:e;return i[1]>n[0]||i[0]===n[0]},overlaps:function(e,t){var i=this,n=i.getPositions(e),r=i.getPositions(t);return i.comparePositions(n[0],r[0])&&i.comparePositions(n[1],r[1])}});return r.prototype.destructor=function(){this.destroySubscriptions(),this.onDestruct&&this.onDestruct(),this.off(),this.remove(),this.$el.empty()},r});